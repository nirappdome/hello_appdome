version: 2.1

parameters:
  app-file:
    type: string
    default: ""
  fusion-set-id:
    type: string
    default: ""
  keystore-file:
    type: string
    default: ""
  keystore-password:
    type: string
    default: ""
  keystore-alias:
    type: string
    default: ""
  keystore-key-password:
    type: string
    default: ""
    
jobs:
  build:
    docker:
      - image: cimg/python:3.9.16
        auth:
          username: mydockerhub-user
          password: $DOCKERHUB_PASSWORD  # context / project UI env-var reference
    steps:
      - checkout
      - run:
          name: Clone Appdome API repository
          command: |
            git clone https://github.com/Appdome/appdome-api-python.git
      - run:
          name: Install requirments
          command: |
            pip3 install -r ./appdome-api-python/requirements.txt
            sudo apt install wget
      - run:
          name: Build Sign Download
          command: |
            python3 ./appdome-api-python/appdome-api-python/appdome_api.py --api_key key --fusion_set_id << pipeline.parameters.fusion-set-id >> --team_id ti --app << pipeline.parameters.app-file >> --sign_on_appdome --keystore << pipeline.parameters.keystore-file >> --keystore_pass << pipeline.parameters.keystore-password >> --keystore_alias << pipeline.parameters.keystore-alias >> --key_pass << pipeline.parameters.keystore-key-password >> --output o/ --certificate_output o/cert.pdf
